<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ÎèôÎ¨º Îã¨Î¶¨Í∏∞ Ï∂îÏ≤®</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    body {
      font-family: sans-serif;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 10px;
      box-sizing: border-box;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 10px;
      width: 100%;
      max-width: 600px;
      backdrop-filter: blur(4px);
      background: rgba(255,255,255,0.8);
      padding: 10px;
      border-radius: 8px;
      box-sizing: border-box;
    }
    .item {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .item img {
      width: 100%;
      cursor: pointer;
      border: 2px solid transparent;
      border-radius: 8px;
      transition: transform .2s;
    }
    .item img:hover { transform: scale(1.05); }
    .item img.selected {
      border-color: #4caf50;
      box-shadow: 0 0 10px rgba(76,175,80,0.5);
    }
    .caption {
      margin-top: 6px;
      font-size: 0.9rem;
    }
    button {
      padding: 12px 20px;
      font-size: 1rem;
      cursor: pointer;
      margin: 15px 0;
      background: #4caf50;
      color: white;
      border: none;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      transition: background .2s;
      width: 90%;
      max-width: 300px;
    }
    button:hover:not(:disabled) { background: #45a049; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    #race-container {
      position: relative;
      width: 100%;
      max-width: 600px;
      margin: 10px auto;
      overflow: visible;
      border-top: 2px solid #ccc;
      border-bottom: 2px solid #ccc;
      background-size: cover;
      border-radius: 8px;
      box-sizing: border-box;
    }
    .runner {
      position: absolute;
      display: flex;
      align-items: center;
      height: 60px;
      padding-left: 8px;
      will-change: transform;
      transition: transform 0.1s ease-out;
    }
    .runner img {
      width: 40px;
      margin-right: 8px;
      transition: transform 0.2s ease-in-out;
    }
    .runner.jump img {
      animation: jump 0.4s ease-out;
    }
    @keyframes jump {
      0% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0); }
    }
    #result {
      margin-top: 20px;
      font-size: 1.3rem;
      font-weight: bold;
      color: #333;
      text-shadow: 1px 1px 2px rgba(255,255,255,0.7);
      word-break: keep-all;
    }
  </style>
</head>
<body>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4252360374523568"
    crossorigin="anonymous"></script>
  <h1>ÎèôÎ¨º Îã¨Î¶¨Í∏∞ Ï∂îÏ≤®</h1>

  <div class="grid" id="animal-grid"></div>
  <button id="start-btn" disabled>Í≤ΩÏ£º ÏãúÏûë</button>
  
  <div id="race-container" style="display:none;"></div>
  <div id="result"></div>

  <script>
    const animalNames = [
      'ÏõêÏà≠Ïù¥', 'Ìé≠Í∑Ñ', 'Î∂ÑÌôç ÌÜ†ÎÅº', 'Í∏∞Î¶∞', 'Ïó¨Ïö∞',
      'ÏΩîÎÅºÎ¶¨', 'ÌåêÎã§', 'Ìò∏ÎûëÏù¥', 'ÏΩîÏïåÎùº', 'Ìù∞ÏÉâ ÌÜ†ÎÅº'
    ];
    const grid = document.getElementById('animal-grid');
    const startBtn = document.getElementById('start-btn');
    const raceContainer = document.getElementById('race-container');
    const resultDiv = document.getElementById('result');
    const images = animalNames.map((_, i) => `./images/animal${i+1}.png`);
    let selected = [];

    // Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ± Î∞è ÏÑ†ÌÉù Í∏∞Îä•
    images.forEach((src, idx) => {
      const wrapper = document.createElement('div');
      wrapper.className = 'item';
      const img = document.createElement('img');
      img.src = src;
      img.alt = animalNames[idx];
      img.addEventListener('click', () => toggleSelect(img, idx));
      const cap = document.createElement('span');
      cap.className = 'caption';
      cap.textContent = animalNames[idx];
      wrapper.append(img, cap);
      grid.appendChild(wrapper);
    });

    function toggleSelect(img, idx) {
      if (img.classList.contains('selected')) {
        img.classList.remove('selected');
        selected = selected.filter(i => i !== idx);
      } else if (selected.length < 10) {
        img.classList.add('selected');
        selected.push(idx);
      }
      startBtn.disabled = selected.length < 2 || selected.length > 10;
    }

    startBtn.addEventListener('click', () => {
      const trackBgList = ['background-track.png', 'background-sand.png', 'background-savannah.png'];
      raceContainer.style.background = `url('./images/${trackBgList[Math.floor(Math.random()*trackBgList.length)]}') repeat-x bottom`;
      raceContainer.style.backgroundSize = 'cover';

      grid.style.display = 'none';
      startBtn.style.display = 'none';
      raceContainer.style.display = 'block';
      raceContainer.style.height = `${selected.length * 60}px`;
      runRace(selected);
    });

    // Í∞úÏÑ†Îêú Í≤ΩÏ£º Ïï†ÎãàÎ©îÏù¥ÏÖò
    function runRace(arr) {
      raceContainer.innerHTML = "";
      const trackWidth = raceContainer.clientWidth - 60;
      const runners = [];
      const finishOrder = [];

      arr.forEach((idx, i) => {
        const runner = document.createElement('div');
        runner.className = 'runner';
        runner.style.top = `${i * 60}px`;
        const img = document.createElement('img');
        img.src = images[idx];
        runner.appendChild(img);
        raceContainer.appendChild(runner);

        // ÏõêÎûò transitionÍ≥º ÎπÑÏä∑Ìïú Ï¥ù ÏãúÍ∞Ñ ÎßûÏ∂îÍ∏∞
        const totalFrames = Math.random() * 180 + 180; // 3~6Ï¥à Ï†ïÎèÑ(60fps Í∏∞Ï§Ä)
        const baseSpeed = trackWidth / totalFrames;

        runners.push({
          idx,
          el: runner,
          x: 0,
          baseSpeed: baseSpeed,
          speed: baseSpeed,
          changeFrames: [ // ÏÜçÎèÑ Î∞îÎÄåÎäî ÌÉÄÏù¥Î∞ç 2~3Ìöå
            Math.floor(totalFrames * 0.3),
            Math.floor(totalFrames * 0.6),
            Math.floor(totalFrames * 0.85)
          ],
          frame: 0
        });
      });

      function animate() {
        runners.forEach(runner => {
          if (finishOrder.includes(runner)) return;

          runner.frame++;

          // 2~3Ìöå ÏÜçÎèÑ ÎûúÎç§ Î≥ÄÌôò
          if (runner.changeFrames.includes(runner.frame)) {
            runner.speed = runner.baseSpeed * (Math.random() * 0.6 + 0.7); // 0.7~1.3Î∞∞
          }

          // Ï¢åÏö∞ ÌùîÎì§Î¶º Ìö®Í≥º(Ï∂îÏõî ÎäêÎÇå)
          const wobble = Math.sin(runner.frame / 5) * 2; 

          runner.x += runner.speed;
          runner.el.style.transform = `translate(${runner.x}px, ${wobble}px)`;

          // Í≤∞ÏäπÏÑ† ÎèÑÎã¨
          if (runner.x >= trackWidth) {
            finishOrder.push(runner);
            runner.el.classList.add('jump'); // Ï†êÌîÑ Ìö®Í≥º
            const rankEl = document.createElement('span');
            rankEl.className = 'rank';
            rankEl.textContent = `${finishOrder.length}ÏúÑ`;
            runner.el.appendChild(rankEl);

            if (finishOrder.length === arr.length) {
              const last = finishOrder[finishOrder.length - 1];
              resultDiv.textContent = `üéâ ÎãπÏ≤®(Íº¥Îì±): ${animalNames[last.idx]}`;
            }
          }
        });

        if (finishOrder.length < arr.length) {
          requestAnimationFrame(animate);
        }
      }

      requestAnimationFrame(animate);
    }
  </script>
</body>
</html>
